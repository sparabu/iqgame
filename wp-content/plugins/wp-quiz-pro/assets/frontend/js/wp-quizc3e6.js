"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(s,o){s.helpers=s.helpers||{},void 0===Object.values&&(Object.values=function(t){return Object.keys(t).map(function(e){return t[e]})}),s.helpers.loadEmbed=function(s,n){if(!s.hasClass("active")){var e={post_ID:0,type:"embed",shortcode:"[embed]"+n.url+"[/embed]",maxwidth:1e3},t=wp.ajax.post("parse-embed",e);t.done(function(e){var t=o(e.body);if(t.attr("width","100%"),t.attr("height","100%"),n.placeholder){var i=t.attr("src");t.attr("src",0<=i.indexOf("?")?i+"&autoplay=1":i+"?autoplay=1")}t.wrap('<div class="wq-embed-content"></div>').appendTo(s),s.addClass("active")}),t.fail(function(e){console.error(e.message)})}},s.helpers.getRequest=function(e){return e.beforeSend||(e.beforeSend=function(e){e.setRequestHeader("X-WP-Nonce",s.restNonce)}),e.method&&!e.type?e.type=e.method:!e.method&&e.type&&(e.method=e.type),o.ajax(e)},s.helpers.showLoading=function(e){var t=o(e);t.find(".wq-loading").length||(t.css("position","relative"),t.append('<div class="wq-loading"><span class="wq-icon wq-icon-spinner animate-spin wq-spinner"></span></div>')),t.addClass("wq-is-loading")},s.helpers.hideLoading=function(e){o(e).removeClass("wq-is-loading")},o.fn.extend({animateCss:function(e,t){var i=function(e){var t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in t)if(void 0!==e.style[i])return t[i]}(document.createElement("div"));return this.addClass("animated "+e).one(i,function(){o(this).removeClass("animated "+e),"function"==typeof t&&t()}),this}});var n=(_createClass(i,[{key:"start",value:function(){var s=this;this.updateUI(this.total);var n=Date.now(),r=0;this.requestId=requestAnimationFrame(function e(){var t=Date.now();if(t-n>1e3*s.total)return s.stop(),s.updateUI("0"),void s.$el.trigger("timesUp");var i=parseInt((t-n)/1e3);r<i&&(r=i,s.updateUI(s.total-r)),s.requestId=requestAnimationFrame(e)})}},{key:"stop",value:function(){cancelAnimationFrame(this.requestId)}},{key:"current",value:function(){return parseFloat(this.$el.text())}},{key:"updateUI",value:function(e){if("on"===s.showTimerMinute){var t=parseInt(e/60),i=parseInt(e%60);return 0<t?void this.$el.text(t+"m"+i+"s"):void this.$el.text(i+"s")}this.$el.text(e+"s")}}]),i);function i(e,t){_classCallCheck(this,i),this.$el=e,this.total=parseInt(t),this.requestId=null,this.step=1e3}function r(e,i){if(_classCallCheck(this,r),(this.$wrapper=e).data("wpQuiz",this),"object"===_typeof(i.questions)&&Object.values(i.questions).forEach(function(t){"object"===_typeof(t.answers)&&Object.values(t.answers).forEach(function(e){"string"==typeof e.isCorrect&&(i.questions[t.id].answers[e.id].isCorrect=parseInt(e.isCorrect))})}),this.quizData=i,this.quizId=i.id,this.questions=i.questions?Object.values(i.questions):[],this.results=i.results?Object.values(i.results):[],this.settings=i.settings||{},this.shareUrl=i.shareUrl,this.currentQuestionIndex=0,this.totalQuestions=this.questions.length,this.lastQuestionIndex=this.totalQuestions-1,this.totalAnswered=0,this.totalCorrects=0,this.tracker={},this.resultId=null,this.result=null,this.isSavedPlayer=!1,this.isGaTracked=!1,this.points={},this.nextQuestionDelay=parseInt(s.next_question_delay)||2e3,this.nextQuestionDelayWithExplanation=parseInt(s.next_question_delay_with_explanation)||5e3,this.hasForceAction()&&(this.settings.end_answers="on"),this.isAnswerOnly=!!parseInt(i.answer_only),!this.isAnswerOnly){var t=this.getProgressFromCookie();t&&(i.is_continued?("string"==typeof t&&(t=JSON.parse(t)),this.continueFromProgress(t)):this.removeProgressFromCookie()),this.hasTimer()&&(this.timer=new n(this.$wrapper.find(".wq-timer"),this.settings.countdown_timer)),this.hasOverallTimer()&&(this.overallTimer=new n(this.$wrapper.find(".wq-overall-timer"),this.settings.overall_time))}this.loadCommonEvents(),this.loadEvents()}s.Quiz=(_createClass(r,[{key:"isEmpty",value:function(e){return void 0===e||""===e||!1===e||0===e||""===e||{}===e||[]===e}},{key:"hasForceAction",value:function(){return this.settings.force_action&&"0"!==this.settings.force_action}},{key:"hasTimer",value:function(){return!this.isAnswerOnly&&!this.hasOverallTimer()&&this.isMultipleLayout()&&0<parseInt(this.settings.countdown_timer)&&this.$wrapper.find(".wq-timer").length}},{key:"hasOverallTimer",value:function(){return!parseInt(this.settings.refresh_step)&&!this.isAnswerOnly&&this.settings.overall_time&&0<parseInt(this.settings.overall_time)&&this.$wrapper.find(".wq-overall-timer").length}},{key:"startTimer",value:function(){this.hasTimer()&&(this.timer.$el.show(),this.timer.start())}},{key:"startOverallTimer",value:function(){this.hasOverallTimer()&&(this.overallTimer.$el.show(),this.overallTimer.start())}},{key:"stopTimer",value:function(){this.hasTimer()&&this.timer.stop()}},{key:"stopOverallTimer",value:function(){this.hasOverallTimer()&&this.overallTimer.stop()}},{key:"isShowPlayData",value:function(){return!this.isEmpty(this.quizData.playData)}},{key:"isResultInPopup",value:function(){return!this.isShowPlayData()&&(this.isEmpty(this.settings.result_popup)?"on"===s.settings.result_popup:"yes"===this.settings.result_popup)}},{key:"isShowNextButton",value:function(){return"off"!==this.settings.show_next_button}},{key:"isMultipleLayout",value:function(){return"multiple"===this.settings.question_layout}},{key:"gaTrackEvent",value:function(){if("undefined"!=typeof ga&&"on"===s.settings.ga_event_tracking&&s.settings.ga_tracking_id&&s.settings.ga_event_category&&s.settings.ga_event_action&&!this.isGaTracked){var e=s.settings.ga_event_category,t=s.settings.ga_event_action,i=s.settings.ga_event_label.replace("%QUIZ_NAME%",this.quizData.name);ga("send","event",{eventCategory:e,eventAction:t,eventLabel:i}),this.isGaTracked=!0}}},{key:"showAnswered",value:function(){}},{key:"loadCommonEvents",value:function(){var t=this;this.$wrapper.on("click",".wq-embed-toggle-btn",function(e){return t.handleClickToggleEmbed(e)}),this.$wrapper.on("click",".wq-embed:not(.active)",function(e){if(e.currentTarget.querySelector("img")){var t=e.currentTarget.querySelector("iframe"),i=t.src;e.currentTarget.classList.add("active"),t&&(t.src=0<=i.indexOf("?")?i+"&autoplay=1":i+"?autoplay=1")}})}},{key:"loadEvents",value:function(){var t=this;this.$wrapper.on("click.answer",".wq-answer",function(e){return t.handleClickAnswer(e)}),this.$wrapper.on("click.nextQuestion",".wq-continue-btn",function(e){return t.handleClickNextQuestionButton(e)}),this.$wrapper.on("click.retakeQuiz",".wq-retake-quiz-btn",function(e){return t.handleClickRestartQuizButton(e)}),this.$wrapper.on("click.beginQuiz",".wq-begin-quiz-btn",function(e){return t.handleClickBeginQuiz(e)}),this.$wrapper.on("wp_quiz_complete_force_action",function(e){t.$wrapper.find(".wq_quizForceActionCtr").hide(),t.showResult()}),this.hasTimer()&&this.timer.$el.on("timesUp",function(){var e=t.$wrapper.find(".wq-question:visible");e.hasClass("wq-is-ad")||(e.addClass("wq_questionAnswered is-incorrect"),t.totalAnswered++,t.currentQuestionIndex++,t.updateProgressBar(),t.$wrapper.hasClass("wq-quiz-trivia")&&(t.checkedAnswersList+="<div><p><strong>"+t.questions[e.attr("data-index")].title+"</strong></p>",t.checkedAnswersList+="<p>"+t.quizData.i18n.noAnswer+"</p>")),t.showTheNextQuestion(e)}),this.hasOverallTimer()&&this.overallTimer.$el.on("timesUp",function(){t.$wrapper.find(".wq-question:not(.wq_questionAnswered)").addClass("wq_questionAnswered is-incorrect"),t.isMultipleLayout()&&(t.updateProgressBar(100),t.$wrapper.find(".wq-question").hide(),t.$wrapper.find(".wq-question:last-child").show()),t.totalAnswered=t.totalQuestions,t.currentQuestionIndex=t.lastQuestionIndex,t.complete()})}},{key:"handleClickAnswer",value:function(e){var t=o(e.currentTarget);if(!(this.timer&&this.timer.timesUp||t.hasClass("chosen"))){var i=t.closest(".wq-question");this.isAnswered(i)||(t.closest(".wq-answer").addClass("chosen"),this.isFullyAnswered(i)&&(i.addClass("wq_questionAnswered"),this.trackAnswer(i),this.totalAnswered++,this.currentQuestionIndex=parseInt(i.attr("data-index")),this.afterClickAnswer(t,i),!this.isShowNextButton()&&this.shouldRefreshPage()||this.nextQuestion()))}}},{key:"handleClickNextQuestionButton",value:function(e){e.preventDefault();var t=o(e.currentTarget).closest(".wq-question");this.currentQuestionIndex--,this.shouldRefreshPage()?this.doRefreshPage():(this.currentQuestionIndex++,this.showTheNextQuestion(t))}},{key:"handleClickRestartQuizButton",value:function(e){e.preventDefault(),this.restartQuiz()}},{key:"handleClickToggleEmbed",value:function(e){e.preventDefault(),o(e.currentTarget).parent().toggleClass("active").next().slideToggle("fast")}},{key:"handleClickBeginQuiz",value:function(e){var t=this;e.preventDefault(),this.$wrapper.find(".wq-quiz-intro-container").fadeOut("fast",function(){t.$wrapper.find(".wq-progress-bar-container, .wq-questions, .wq-embed-toggle, .wq_promoteQuizCtr").fadeIn("fast"),t.startTimer(),t.startOverallTimer()})}},{key:"showTheNextQuestion",value:function(e){var s=this;if(e.next(".wq-question").length){var t=function(i){i.animateCss(s.settings.animation_out,function(){var e=i.next(".wq-question"),t=i.offset().top;i.hide(),"on"===s.settings.auto_scroll&&o("html, body").animate({scrollTop:t-95}),e.show().animateCss(s.settings.animation_in,function(){s.timer&&!e.find(".wq-answer.chosen").length&&s.timer.start()})})};if(this.isAnswered(e)){if(this.totalAnswered<this.totalQuestions)if("trivia"!==this.quizData.type||this.isShowNextButton())t(e);else{var i=this.questions[this.currentQuestionIndex].desc.length?this.nextQuestionDelayWithExplanation:this.nextQuestionDelay;setTimeout(function(){t(e)},i)}if(this.stopTimer(),e.find(".wq-embed iframe").length){var n=e.find(".wq-embed iframe"),r=n.attr("src");n.attr("src",""),n.attr("src",r.replace("&autoplay=1",""))}e.find(".wq-question-video video").length&&e.find(".wq-question-video video")[0].player&&e.find(".wq-question-video video")[0].player.pause()}}else this.complete()}},{key:"isFullyAnswered",value:function(){return!0}},{key:"afterClickAnswer",value:function(e,t){if(this.shouldSaveProgress()&&this.saveProgressToCookie(),this.isMultipleLayout())if(this.$wrapper.find(".wq_quizProgressBar").length&&this.updateProgressBar(),this.isShowNextButton()){var i=t.find(".wq_continue");this.totalAnswered<this.totalQuestions&&t.find(".wq_continue").length&&i.show()}else{if(this.shouldRefreshPage())return void this.doRefreshPage();this.showTheNextQuestion(t)}this.stopTimer()}},{key:"updateProgressBar",value:function(e){void 0===e&&(e=parseInt(100*this.totalAnswered/this.totalQuestions)),this.$wrapper.find(".wq_quizProgressValue").animate({width:e+"%"}).text(e+"%")}},{key:"nextQuestion",value:function(){return this.totalAnswered===this.totalQuestions?this.complete():this.currentQuestionIndex===this.lastQuestionIndex?(this.currentQuestionIndex=-1,this.nextQuestion()):(this.currentQuestionIndex++,this.isAnswered(this.currentQuestionIndex)?this.nextQuestion():void(this.isMultipleLayout()||"on"!==this.settings.auto_scroll||this.scrollToQuestion(this.currentQuestionIndex)))}},{key:"shouldSaveProgress",value:function(){return!this.isAnswerOnly&&this.isMultipleLayout()&&parseInt(this.settings.refresh_step)}},{key:"shouldRefreshPage",value:function(e){return 0<arguments.length&&void 0!==e&&e?this.shouldSaveProgress():!this.isAnswerOnly&&this.isMultipleLayout()&&parseInt(this.settings.refresh_step)&&0==(this.currentQuestionIndex+1)%parseInt(this.settings.refresh_step)}},{key:"doRefreshPage",value:function(){this.saveProgressToCookie(),window.location.href=window.location.href}},{key:"complete",value:function(){var s=this;if(!this.isAnswerOnly){this.stopOverallTimer(),this.$wrapper.addClass("is-completed"),this.findResultId(),this.isSavedPlayer||(this.savePlayData(),this.isSavedPlayer=!0),this.gaTrackEvent();var e=this.$wrapper.find(".wq-force-action-container"),t=this.$wrapper.find('.wq-question[data-index="'+this.lastQuestionIndex+'"]'),i=function(t,i){i.animateCss(s.settings.animation_out,function(){i.hide();var e=i.offset().top;i.hide(),"on"===s.settings.auto_scroll&&o("html, body").animate({scrollTop:e-95}),t.show().animateCss(s.settings.animation_in)})},n=0<this.questions[this.lastQuestionIndex].desc.length?this.nextQuestionDelayWithExplanation:this.nextQuestionDelay;if(e.length)"trivia"===this.quizData.type&&this.isMultipleLayout()?setTimeout(function(){i(e,t)},n):"personality"===this.quizData.type&&this.isMultipleLayout()?i(e,t):e.show();else if(this.results.length){if(this.shouldRefreshPage(!0))return void this.doRefreshPage();"trivia"===this.quizData.type&&this.isMultipleLayout()?setTimeout(function(){s.showResult()},n):this.showResult()}this.isMultipleLayout()||("on"!==this.settings.end_answers||this.hasForceAction()?this.results.length&&"on"===this.settings.auto_scroll&&this.scrollToResults():this.scrollToQuestion(0)),this.$wrapper.trigger("wp_quiz_complete_quiz",[this])}}},{key:"showPlayAgainButton",value:function(){this.$wrapper.find(".wq-retake-quiz").length&&this.$wrapper.find(".wq-retake-quiz").show()}},{key:"findResultId",value:function(){}},{key:"trackAnswer",value:function(){}},{key:"savePlayData",value:function(){}},{key:"saveProgressToCookie",value:function(){if("undefined"!=typeof Cookies){var t=[];this.questions.forEach(function(e){t.push(e.id)});var e={tracker:this.tracker,totalCorrects:this.totalCorrects,currentQuestionIndex:this.currentQuestionIndex,totalAnswered:this.totalAnswered,points:this.points,questionIds:t};Cookies.set(this.getProgressCookieName(),e,{expires:1/24})}}},{key:"getProgressFromCookie",value:function(){if("undefined"!=typeof Cookies)return Cookies.get(this.getProgressCookieName())}},{key:"getProgressCookieName",value:function(){return"wp_quiz_progress_"+this.quizId}},{key:"removeProgressFromCookie",value:function(){"undefined"!=typeof Cookies&&Cookies.remove(this.getProgressCookieName())}},{key:"continueFromProgress",value:function(){}},{key:"showResult",value:function(){}},{key:"scrollToResults",value:function(){var e=this.$wrapper.find(".wq-force-action-container").length?this.$wrapper.find(".wq-force-action-container"):this.$wrapper.find(".wq-results");o("html, body").animate({scrollTop:e.offset().top-95})}},{key:"scrollToQuestion",value:function(e){o("html, body").animate({scrollTop:this.$wrapper.find('.wq-question[data-index="'+e+'"]').offset().top-95})}},{key:"scrollToQuiz",value:function(){o(window).scrollTop(o("#wp-quiz-"+this.quizId).offset().top-95)}},{key:"restartQuiz",value:function(){this.currentQuestionIndex=0,this.totalAnswered=0,this.totalCorrects=0,this.tracker={},this.isSavedPlayer=!1,this.isGaTracked=!1,this.isMultipleLayout()&&(this.$wrapper.find(".wq-question").hide(),this.$wrapper.find('.wq-question[data-index="0"]').show()),this.scrollToQuestion(0),this.updateProgressBar(),this.$wrapper.removeClass("is-completed"),this.$wrapper.removeClass("show-played"),this.$wrapper.find(".wq_questionAnswered").removeClass("wq_questionAnswered"),this.$wrapper.find(".is-correct").removeClass("is-correct"),this.$wrapper.find(".is-incorrect").removeClass("is-incorrect"),this.$wrapper.find(".chosen").removeClass("chosen"),this.$wrapper.find(".wq-question:not(.wq-is-ad) .wq_continue, .wq_quizForceActionCtr, .wq-results, .wq-result, .wq-force-action-container, .wq-retake-quiz, .wq-question-timer").hide(),this.$wrapper.find(".wq-question").removeClass("force-show"),this.hasTimer()&&(this.$wrapper.find(".wq-quiz-intro-container").show(),this.$wrapper.find(".wq-progress-bar-container, .wq-questions").hide()),this.startOverallTimer(),this.removeProgressFromCookie()}},{key:"isAnswered",value:function(e){return"function"==typeof e.hasClass?e.hasClass("wq_questionAnswered")||e.hasClass("wq-is-ad"):this.$wrapper.find('.wq-question[data-index="'+e+'"]').hasClass("wq_questionAnswered")}}]),r),o(document).ready(function(){o(document).on("click",".wq-share-fb",function(e){if("undefined"!=typeof FB){e.preventDefault();var t=e.currentTarget.dataset.url;if(e.currentTarget.dataset.trackingId){var i=e.currentTarget.dataset.trackingId;t=-1===t.indexOf("?")?t+"?wqtid="+i:t+"&wqtid="+i}else if(e.currentTarget.dataset.imageFile){var s=e.currentTarget.dataset.imageFile;t=-1===t.indexOf("?")?t+"?wqimg="+s:t+"&wqimg="+s}FB.ui({method:"share",href:t},function(e){console.log(e)})}}),o(document).on("click",".wq-share-tw",function(e){e.preventDefault();var t=e.currentTarget.dataset.url;if(e.currentTarget.dataset.trackingId){var i=e.currentTarget.dataset.trackingId;t=-1===t.indexOf("?")?t+"?wqtid="+i:t+"&wqtid="+i}else if(e.currentTarget.dataset.imageFile){var s=e.currentTarget.dataset.imageFile;t=-1===t.indexOf("?")?t+"?wqimg="+s:t+"&wqimg="+s}t="https://twitter.com/intent/tweet?url="+encodeURIComponent(t);var n=o(e.currentTarget).closest(".wq-quiz").find(".wq-result:visible .wq-result-score"),r=o(e.currentTarget).closest(".wq-quiz").find(".wq-result:visible .wq-result-title");n.length&&n.text()?t+="&text="+encodeURIComponent(n.text()):r.length&&r.text()&&(t+="&text="+encodeURIComponent(r.text())),window.open(t,"_blank","width=500, height=300")}),o(document).on("click",".wq-share-vk",function(e){e.preventDefault();var t=e.currentTarget.dataset.url;if(e.currentTarget.dataset.trackingId){var i=e.currentTarget.dataset.trackingId;t=-1===t.indexOf("?")?t+"?wqtid="+i:t+"&wqtid="+i}else if(e.currentTarget.dataset.imageFile){var s=e.currentTarget.dataset.imageFile;t=-1===t.indexOf("?")?t+"?wqimg="+s:t+"&wqimg="+s}window.open("http://vk.com/share.php?url="+encodeURIComponent(t),"_blank","width=500, height=300")}),o(document).on("click",".wq-question-hint-button",function(e){return e.stopPropagation(),e.preventDefault(),o(this).prev(".wq-question-hint-content").slideToggle(),!1}),o(document).on("click",".wq-question-hint-content",function(e){return e.stopPropagation()}),o(document).on("click",function(e){return o(".wq-question-hint-content").hide()})})}(wpQuiz,jQuery);