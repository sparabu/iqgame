"use strict";var _createClass=function(){function i(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),_get=function t(e,s,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,s);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,s,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(u,d){var e=(_inherits(i,u.Quiz),_createClass(i,[{key:"isFullyAnswered",value:function(t){var e=t.attr("data-index");return parseInt(this.questions[e].totalCorrects)<=t.find(".wq-answer.chosen").length}},{key:"afterClickAnswer",value:function(t,e){"multiple"!==this.settings.question_layout&&"on"===this.settings.end_answers||this.checkQuestion(e),_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"afterClickAnswer",this).call(this,t,e)}},{key:"checkQuestion",value:function(i){var r=this,t=i.attr("data-index"),n=this.questions[t];if(n){var a=0<i.find(".wq-answer.chosen").length;this.checkedAnswersList+='<div class="wq-checked-answers-list__question">',this.checkedAnswersList+='<div class="wq-checked-answers-list__question-title">'+n.title+"</div>",Object.keys(n.answers).forEach(function(t){var e=n.answers[t],s=i.find('.wq-answer[data-id="'+t+'"]');e.isCorrect&&parseInt(e.isCorrect)?s.addClass("wq_correctAnswer"):s.hasClass("chosen")&&(s.addClass("wq_incorrectAnswer"),a=!1),s.hasClass("chosen")&&(r.checkedAnswersList+='\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="wq-checked-answers-list__answer '+(a?"is-correct":"is-incorrect")+'"\n\t\t\t\t\t\t>'+e.title+"</div>\n\t\t\t\t\t"),"on"===r.settings.end_answers&&"multiple"===r.settings.question_layout&&s.removeClass("wq_correctAnswer").removeClass("wq_incorrectAnswer")}),n.desc&&(this.checkedAnswersList+='<div class="wq-checked-answers-list__question-desc">'+n.desc+"</div>"),this.checkedAnswersList+="</div>",a?(this.totalCorrects++,i.addClass("is-correct")):i.addClass("is-incorrect"),"off"!==this.settings.end_answers&&"single"!==this.settings.question_layout&&!i.find(".wq-trivia-question-explanation").length||i.find(".wq-trivia-question-explanation").fadeIn()}}},{key:"trackAnswer",value:function(t){var e=t.attr("data-index"),s=this.questions[e],i={answers:[]};this.timer&&(i.time=parseFloat(this.settings.countdown_timer)-this.timer.current()),t.find(".wq-answer.chosen").each(function(t,e){return i.answers.push(e.dataset.id)}),this.tracker[s.id]=i}},{key:"complete",value:function(){var t=this;"single"===this.settings.question_layout&&"on"===this.settings.end_answers&&this.$wrapper.find(".wq-question").each(function(){t.checkQuestion(d(this))}),_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"complete",this).call(this)}},{key:"findResultId",value:function(){var e=this,s=this.totalCorrects,i=!1;this.results.forEach(function(t){i||s>=t.min&&s<=t.max&&(i=!0,e.resultId=t.id,e.result=t)})}},{key:"showResult",value:function(){var t=this,e=this.totalCorrects,s=this.totalQuestions;if(this.$wrapper.find(".wq-timer").hide(),this.result.redirect_url){var i=0<this.questions[this.lastQuestionIndex].desc.length?this.nextQuestionDelayWithExplanation:this.nextQuestionDelay;setTimeout(function(){window.location.href=t.result.redirect_url.replace("%%score%%",e).replace("%%total%%",s)},i)}else{var r=this.$wrapper.find(".wq-results"),n=this.$wrapper.find('.wq-result[data-id="'+this.resultId+'"]'),a=u.i18n.resultScore.replace("%%score%%",e).replace("%%total%%",s),o=this.$wrapper.find('.wq-question[data-index="'+this.lastQuestionIndex+'"]');if(n.find(".wq-result-score").text(a),n.find(".wq-checked-answers-list").html(this.checkedAnswersList),"on"===this.settings.end_answers&&"multiple"===this.settings.question_layout&&n.find(".wq-checked-answers-list").addClass("must-show"),n.show(),this.$wrapper.addClass("wq-should-show-correct-answer"),this.isResultInPopup()&&void 0!==d.magnificPopup){var c=["max-width: "+this.$wrapper.width()+"px","padding: 0"],l=r.clone();l.show();var h='<div class="wq-popup" style="'+c.join("; ")+'">'+l.prop("outerHTML")+"</div>";return d.magnificPopup.open({items:{src:h,type:"inline"}}),void this.showPlayAgainButton()}"multiple"===this.settings.question_layout&&o.is(":visible")?o.animateCss(this.settings.animation_out,function(){o.hide(),o.offset().top,o.hide(),r.show().animateCss(t.settings.animation_in),t.showPlayAgainButton()}):("on"===this.settings.end_answers&&this.scrollToQuestion(0),r.show(),this.showPlayAgainButton())}}},{key:"savePlayData",value:function(){var e=this,t=u.restUrl+"wp-quiz/v2/play_data",s=u.helpers.getRequest({url:t,method:"POST",data:{quiz_id:this.quizId,quiz_data:JSON.stringify(this.quizData),answered:JSON.stringify(this.tracker),corrects:this.totalCorrects,result_id:this.resultId,current_url:window.location.href}});s.done(function(t){"number"==typeof t&&(e.$wrapper.find(".wq-subscribe-form").attr("data-tracking-id",t),e.$wrapper.find(".wq-share button").attr("data-tracking-id",t),d(".mfp-wrap .wq-popup .wq-share button").attr("data-tracking-id",t),e.$wrapper.find(".wq_forceShareFB").attr("data-tracking-id",t))}),s.fail(function(t){console.error(t)})}},{key:"restartQuiz",value:function(){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"restartQuiz",this).call(this),"on"===this.settings.end_answers&&this.$wrapper.removeClass("wq-should-show-correct-answer"),this.$wrapper.find(".wq_correctExplanationHead").removeClass("wq_correctExplanationHead"),this.$wrapper.find(".wq-trivia-question-explanation").hide(),this.$wrapper.find(".wq_wrongExplanationHead").removeClass("wq_wrongExplanationHead"),this.$wrapper.find(".wq_incorrectAnswer").removeClass("wq_incorrectAnswer"),this.$wrapper.find(".wq_correctAnswer").removeClass("wq_correctAnswer"),this.checkedAnswersList="",this.$wrapper.find(".wq-checked-answers-list").html("").removeClass("must-show")}},{key:"continueFromProgress",value:function(e){var n=this;if(this.currentQuestionIndex=e.currentQuestionIndex+1,this.totalAnswered=e.totalAnswered,this.totalCorrects=e.totalCorrects,this.tracker=e.tracker,this.$wrapper.find(".wq-question").hide(),this.$wrapper.find(".wq-quiz-intro-container").hide(),this.$wrapper.find(".wq-questions").show(),this.updateProgressBar(),this.scrollToQuiz(),this.totalAnswered>=this.totalQuestions){if(this.$wrapper.find(".wq-checked-answers-list").length){this.checkedAnswersList="";var a=0;this.questions.forEach(function(r){if(void 0!==e.tracker[r.id]){var t=e.tracker[r.id].answers;n.checkedAnswersList+="<div><p><strong>"+r.title+"</strong></p>",t.forEach(function(t){var e=r.answers[t],s=n.$wrapper.find('.wq-question[data-index="'+a+'"]').find('.wq-answer[data-id="'+t+'"]'),i=e.isCorrect&&parseInt(e.isCorrect);n.checkedAnswersList+='<p class="'+(i?"is-correct":"is-incorrect")+'">'+s.text()+"</p>"}),n.checkedAnswersList+="</div>",a++}})}this.findResultId(),this.hasForceAction()?this.$wrapper.find(".wq-force-action-container").show():this.showResult(),this.removeProgressFromCookie(),this.isSavedPlayer||(this.savePlayData(),this.isSavedPlayer=!0),this.gaTrackEvent()}else this.$wrapper.find('.wq-question[data-index="'+this.currentQuestionIndex+'"]').show()}}]),i);function i(t,e){_classCallCheck(this,i);var s=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return s.checkedAnswersList="",s}d(document).ready(function(){d(".wq-quiz-trivia").each(function(){var t=d(this).attr("data-quiz-id");void 0!==window["triviaQuiz"+t]&&new e(d(this),window["triviaQuiz"+t])})})}(wpQuiz,jQuery);